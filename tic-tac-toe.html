<!DOCTYPE html>
<html>
<head>
	<title>Welcome to tic-tac-toe</title>
	<meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <link href="https://fonts.googleapis.com/css?family=Cairo|Libre+Baskerville|Merriweather+Sans" rel="stylesheet">
  <link rel="stylesheet" href="tic-tac.css">
</head>
<body>
	
    <h1 class="headline text-center">Advanced Front-End Project</h1>
	<div class="container">
		<div class="row">
  <div class ="col-xs-12">
	  <div id="select-board">
  <h2 class="sub-headline">Welcome To Tic-Tac-Toe</h2>
  <h3>Would You Like to Play X or O</h3>
  <button class="btn-btn" id="btn1">X</button>
  <button class="btn-btn" id="btn2">O</button>
   </div>
    </div>
	</div>
	    </div>
<div class="container">
	<div class="row">
  <div class="col-12-xs">
       <div id="tic-tac-toe>
  <table>
    <tr>
      <td class="cell" id="0"></td>
      <td class="cell" id="1"></td>
      <td class="cell" id="2"></td>
    </tr>
    <tr>
      <td class="cell" id="3"></td>
      <td class="cell" id="4"></td>
      <td class="cell" id="5"></td>
    </tr>
     <tr>
      <td class="cell" id="6"></td>
      <td class="cell" id="7"></td>
      <td class="cell" id="8"></td>
    </tr>
     </table>
   <div class="game-end">
      <div class="text"></div>
     <button class="restart" onClick = "gameStart()">Restart</button>
  </div>
</div>
</div>
						    </div>
						    </div>

<script type="text/javascript">
			 var ticTacBoard;
		var huPlayer = 'O';
		var aiPlayer = 'X';
		var human = $("#btn1").html();
		var computer = $("#btn2").html();

		$(document).ready(function(){
		  $(".btn-btn").click(function(x){
		    $("#tic-tac-toe").fadeIn(3000);
		    x = $(this).html();
		    if (x==human){
		      huPlayer = human;
		      aiPlayer = computer;
		      $("#select-board").hide();
		    }else{
		      huPlayer = computer;
		      aiPlayer = human;
		      $("#select-board").hide();
		    }
		  })
		})
		var win_case = [
		  	[0,1,2],
		  	[3,4,5],
		  	[6,7,8],
		  	[0,3,6],
		  	[1,4,7],
		  	[2,5,8],
		  	[0,4,8],
		  	[6,4,2]
		];
		const cells = document.querySelectorAll('.cell');
		 gameStart();
		function gameStart(){
		  $("#tic-tac-toe").hide();
		  $("#select-board").fadeIn(3000);
		  document.querySelector(".game-end").style.display = "none";
		  ticTacBoard = Array.from(Array(9).keys());
		 
		  for(var i=0;i<cells.length;i++){
		    cells[i].innerText = " ";
		    cells[i].style.removeProperty("background-color");
		    cells[i].addEventListener('click' , clickBoard , false);
		  }
		}
		function clickBoard(square){
		  if (typeof ticTacBoard[square.target.id] =='number'){
		    myTurn(square.target.id,huPlayer);
		if (!checkWin(ticTacBoard, huPlayer) && !gameTie()) myTurn(bestTurn(), aiPlayer);
		  }
		  
		}
		function myTurn(squareId,player){
		  ticTacBoard[squareId] = player;
		  document.getElementById(squareId).innerText = player;
		  var gameWon = checkWin(ticTacBoard,player);
		  	      	if (gameWon) gameOver(gameWon);
		  }
		 function checkWin(board, player){
		    var played = board.reduce((a,e,i) => (e===player) ? a.concat(i) : a, []);
		  	 var gameWon = null;
		     for(var [index , win] of win_case.entries()){
		      if (win.every(elem => played.indexOf(elem)>-1)){
		  	 gameWon = {index:index,player:player};
		  	      break;
		  	        		}
		  	        	}
		  	        	return gameWon;
		  	        }
		  function gameOver(gameWon){
		  	 for(var index of win_case[gameWon.index]){
		  	   document.getElementById(index).style.backgroundColor = 
		  	     gameWon.player == huPlayer ? "blue" : "red";
		      }
		  	   for(var i=0;i<cells.length;i++){
		  	        		cells[i].removeEventListener('click' , clickBoard , false);
		  	        	}
		  	     	declareWinner(gameWon.player == huPlayer ? "You Win" : "You lose");
		   }   
		   
		function declareWinner(check){
		  document.querySelector(".game-end").style.display = "block";
		  document.querySelector(".game-end .text").innerText = check;
		}

		 function emptyBox(){
		   return ticTacBoard.filter(s=> typeof s=='number');
		 }
		 function bestTurn(){
		   return minimax(ticTacBoard,aiPlayer).index;
		 }
		function gameTie(){
		  if (emptyBox().length==0){
		    for(var i=0;i<cells.length;i++){
		      cells[i].style.backgroundColor="green";
		    }
		    declareWinner("Game Tie");
		     return true;
		  }
		    return false;
		}
		function minimax(newBoard,player){
		  var availBox = emptyBox(newBoard);
		  
		  if (checkWin(newBoard, huPlayer)) {
				return {score: -10};
			} else if (checkWin(newBoard, aiPlayer)) {
				return {score: 10};
			} else if (availBox.length===0) {
				return {score: 0};
			}
		  var moves = [];
		  for (var i=0; i<availBox.length; i++){
		  var move = {};
		  move.index = newBoard[availBox[i]];
		  newBoard[availBox[i]] = player;
		   
		  if (player == aiPlayer){
		  var result = minimax(newBoard,huPlayer);
		    move.score = result.score;
		    }
		  else{
		    var result = minimax(newBoard,aiPlayer);
		    move.score = result.score;
		    
		  }
		  newBoard[availBox[i]]= move.index;
		  moves.push(move);
		  }
		  var bestMove;
		  if (player===aiPlayer){
		    var bestScore = -1000;
		    for(var i=0;i<moves.length;i++){
		      if(moves[i].score > bestScore){
		        bestScore = moves[i].score;
		        bestMove = i;
		      }
		    }
		  }else {
		    var bestScore = 1000;
		    for(var i=0;i<moves.length;i++){
		      if (moves[i].score < bestScore){
		        bestScore = moves[i].score;
		        bestMove = i;
		   
		      }
		    }
		  }
		  return moves[bestMove];
		}
</script>



</body>
</html>
